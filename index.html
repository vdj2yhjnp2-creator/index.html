<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drink Pocket</title>
    <script type="module">
        // Firebase - sostituisce localStorage con sincronizzazione automatica
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
        import { getDatabase, ref, onValue, set, push } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDq0z0XzL3kL9z5qZ7xY8w9vT2uR4sQ6pM",
            authDomain: "drink-pocket-sync.firebaseapp.com",
            databaseURL: "https://drink-pocket-sync-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "drink-pocket-sync",
            storageBucket: "drink-pocket-sync.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const drinksRef = ref(db, 'drinks');
    </script>
    <style>
        /* Il tuo CSS originale resta uguale */
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        input, button { padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        .drink { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .search { background: #e8f4fd; padding: 10px; border-radius: 5px; }
        #lista { min-height: 200px; }
    </style>
</head>
<body>
    <h1>üçπ Drink Pocket</h1>
    <p><em>Sincronizza automaticamente tra PC e telefono!</em></p>
    
    <div class="search">
        <input type="text" id="cerca" placeholder="Cerca drink..." oninput="filtraDrinks()">
    </div>
    
    <button onclick="nuovoDrink()">+ Nuovo Drink</button>
    <div id="lista"></div>
    
    <div style="margin-top: 20px;">
        <button onclick="esporta()">üì§ Esporta</button>
        <input type="file" id="importa" accept=".json" onchange="importa(event)" style="display:none;">
        <button onclick="document.getElementById('importa').click()">üì• Importa</button>
    </div>

    <script>
        let tuttiDrinks = [];
        
        // Carica drinks da Firebase (sostituisce localStorage)
        onValue(drinksRef, (snapshot) => {
            tuttiDrinks = snapshot.val() ? Object.values(snapshot.val()) : [];
            mostraDrinks();
        });
        
        function salvaDrinks() {
            set(drinksRef, tuttiDrinks.reduce((acc, drink, i) => {
                acc[i] = drink;
                return acc;
            }, {}));
        }
        
        function nuovoDrink() {
            const nome = prompt("Nome del drink:");
            if (nome) {
                const drink = {
                    nome: nome,
                    ingredienti: "",
                    istruzioni: "",
                    data: new Date().toLocaleDateString()
                };
                tuttiDrinks.push(drink);
                salvaDrinks();
            }
        }
        
        function filtraDrinks() {
            const cerca = document.getElementById('cerca').value.toLowerCase();
            const lista = document.getElementById('lista');
            lista.innerHTML = tuttiDrinks
                .filter(d => d.nome.toLowerCase().includes(cerca))
                .map(mostraDrink)
                .join('');
        }
        
        function mostraDrinks() {
            filtraDrinks();
        }
        
        function mostraDrink(drink, index) {
            return `
                <div class="drink">
                    <h3>${drink.nome}</h3>
                    <p><strong>Ingredienti:</strong> ${drink.ingredienti || 'N/D'}</p>
                    <p><strong>Istruzioni:</strong> ${drink.istruzioni || 'N/D'}</p>
                    <small>${drink.data}</small>
                    <br>
                    <button onclick="modifica(${index})">‚úèÔ∏è Modifica</button>
                    <button onclick="elimina(${index})">üóëÔ∏è Elimina</button>
                </div>
            `;
        }
        
        function modifica(index) {
            const drink = tuttiDrinks[index];
            drink.nome = prompt("Nome:", drink.nome) || drink.nome;
            drink.ingredienti = prompt("Ingredienti:", drink.ingredienti) || drink.ingredienti;
            drink.istruzioni = prompt("Istruzioni:", drink.istruzioni) || drink.istruzioni;
            drink.data = new Date().toLocaleDateString();
            salvaDrinks();
        }
        
        function elimina(index) {
            if (confirm("Eliminare?")) {
                tuttiDrinks.splice(index, 1);
                salvaDrinks();
            }
        }
        
        function esporta() {
            const dataStr = JSON.stringify(tuttiDrinks, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'drink-pocket-backup.json';
            link.click();
        }
        
        function importa(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (confirm("Sovrascrivere i dati?")) {
                        tuttiDrinks = imported;
                        salvaDrinks();
                    }
                } catch(err) {
                    alert("Errore file!");
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
